{"version":3,"sources":["../../src/repositories/bills.js"],"names":["ObjectId","mongoose","Types","BillsRepository","schema","model","data","create","response","console","error","message","user","bills","find","_id","bill","update","paidOut","paidOutDate","Date","now","skip","limit","id"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;AACA,IAAMA,WAAWC,mBAASC,KAAT,CAAeF,QAAhC;;IAEMG,e;AACJ,6BAAe;AAAA;;AACb,SAAKC,MAAL,GAAc,IAAIH,mBAASI,KAAb,CAAmB,OAAnB,CAAd;AACD;;;;;2GAEuBC,I;;;;;;;AAEdD,qB,GAAQ,IAAI,KAAKD,MAAT,CAAgBE,IAAhB,C;;uBAES,KAAKF,MAAL,CAAYG,MAAZ,CAAmBF,KAAnB,C;;;AAAjBG,wB;iDAECA,Q;;;;;;AAEPC,wBAAQC,KAAR,2CAAsD,YAAIC,OAA1D;;;;;;;;;;;;;;;;;;;;6GAKiBC,I,EAAMC,K;;;;;;;;uBAEA,KAAKT,MAAL,CAAYU,IAAZ,CAAiB,EAAEF,MAAMZ,SAASY,IAAT,CAAR,EAAwBG,KAAK,EAAE,OAAOf,SAASa,KAAT,CAAT,EAA7B,EAAjB,C;;;AAAjBL,wB;kDAECA,Q;;;;;;AAEPC,wBAAQC,KAAR,2CAAsD,aAAIC,OAA1D;;;;;;;;;;;;;;;;;;;;6GAKsBK,I;;;;;;;;uBAEC,KAAKZ,MAAL,CAAYa,MAAZ,CAAmB,EAAEF,KAAKf,SAASgB,IAAT,CAAP,EAAnB,EAA4C,EAAEE,SAAS,IAAX,EAAiBC,aAAaC,KAAKC,GAAnC,EAA5C,C;;;AAAjBb,wB;kDAECA,Q;;;;;;AAEPC,wBAAQC,KAAR,8CAAyD,aAAIC,OAA7D;;;;;;;;;;;;;;;;;;;;6GAK4BC,I,EAAMM,O,EAASI,I,EAAMC,K;;;;;;;;uBAE1B,KAAKnB,MAAL,CAAYU,IAAZ,CAAiB,EAAEF,MAAMZ,SAASY,IAAT,CAAR,EAAwBM,gBAAxB,EAAjB,EAAoDI,IAApD,CAAyDA,IAAzD,EAA+DC,KAA/D,CAAqEA,KAArE,C;;;AAAjBf,wB;kDAECA,Q;;;;;;AAGPC,wBAAQC,KAAR,oDAA+D,aAAIC,OAAnE;;;;;;;;;;;;;;;;;;;;6GAKea,E,EAAIF,I,EAAMC,K;;;;;;;;uBAEF,KAAKnB,MAAL,CAAYU,IAAZ,CAAiB,EAAEF,MAAMZ,SAASY,IAAT,CAAR,EAAjB,EAA2CU,IAA3C,CAAgDA,IAAhD,EAAsDC,KAAtD,CAA4DA,KAA5D,C;;;AAAjBf,wB;kDAECA,Q;;;;;;AAGPC,wBAAQC,KAAR,sCAAiD,aAAIC,OAArD;;;;;;;;;;;;;;;;;;;;6GAKgBK,I;;;;;;;AAEVX,qB,GAAQ,IAAI,KAAKD,MAAT,CAAgBY,IAAhB,C;;uBAES,KAAKZ,MAAL,CAAYG,MAAZ,CAAmBF,KAAnB,C;;;AAAjBG,wB;kDAECA,Q;;;;;;AAEPC,wBAAQC,KAAR,0CAAqD,aAAIC,OAAzD;;;;;;;;;;;;;;;;;;;;;kBAMSR,e","file":"bills.js","sourcesContent":["import mongoose from 'mongoose'\r\nimport BillsSchema from '../schemas'\r\nconst ObjectId = mongoose.Types.ObjectId\r\n\r\nclass BillsRepository {\r\n  constructor () {\r\n    this.schema = new mongoose.model('bills')\r\n  }\r\n\r\n  async createUnpaidBill (data) {\r\n    try {\r\n      const model = new this.schema(data)\r\n\r\n      const response = await this.schema.create(model)\r\n\r\n      return response\r\n    } catch (err) {\r\n      console.error(`[BillsRepository - createUnpaidBill] ${err.message}`)\r\n      return err\r\n    }\r\n  }\r\n  \r\n  async findBillsToPay(user, bills) {\r\n    try {\r\n      const response = await this.schema.find({ user: ObjectId(user), _id: { '$in': ObjectId(bills) } })\r\n\r\n      return response\r\n    } catch (err) {\r\n      console.error(`[BillsRepository - createUnpaidBill] ${err.message}`)\r\n      return err\r\n    }\r\n  }\r\n\r\n  async editPaidBillsByCode(bill) {\r\n    try {\r\n      const response = await this.schema.update({ _id: ObjectId(bill) }, { paidOut: true, paidOutDate: Date.now })\r\n\r\n      return response\r\n    } catch (err) {\r\n      console.error(`[BillsRepository - editPaidBillsByCode] ${err.message}`)\r\n      return err\r\n    }\r\n  }\r\n\r\n  async getBillsByStatusOfPayment(user, paidOut, skip, limit) {\r\n    try {\r\n      const response = await this.schema.find({ user: ObjectId(user), paidOut }).skip(skip).limit(limit)\r\n\r\n      return response\r\n    }\r\n    catch (err) {\r\n      console.error(`[BillsRepository - getBillsByStatusOfPayment] ${err.message}`)\r\n      return err\r\n    }\r\n  }\r\n\r\n  async getAllBills (id, skip, limit) {\r\n    try {\r\n      const response = await this.schema.find({ user: ObjectId(user) }).skip(skip).limit(limit)\r\n\r\n      return response\r\n    }\r\n    catch (err) {\r\n      console.error(`[BillsRepository - getAllBills] ${err.message}`)\r\n      return err\r\n    }\r\n  }\r\n\r\n  async addBillToUser(bill) {\r\n    try {\r\n      const model = new this.schema(bill)\r\n\r\n      const response = await this.schema.create(model)\r\n\r\n      return response\r\n    } catch (err) {\r\n      console.error(`[PaymentRepository - addBillToUser] ${err.message}`)\r\n      return err\r\n    }\r\n  }\r\n}\r\n\r\nexport default BillsRepository\r\n"]}